cmake_minimum_required(VERSION 3.10)
project(PrMers LANGUAGES CXX)

set(CMAKE_CXX_STANDARD 20)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# === OpenCL ===
find_package(OpenCL REQUIRED)

# === GMP (vcpkg config mode) ===
find_package(GMP CONFIG REQUIRED)

# === libcurl (optional) ===
option(USE_CURL "Enable libcurl support" ON)
if (USE_CURL)
  find_package(CURL REQUIRED)
endif()

# === Source files & include dir ===
file(GLOB_RECURSE SOURCES src/*.cpp)
target_include_directories(prmers PRIVATE
  ${PROJECT_SOURCE_DIR}/include
)

# === Executable ===
add_executable(prmers ${SOURCES})

# === Compile definitions ===
if (WIN32)
  target_compile_definitions(prmers PRIVATE KERNEL_PATH="\"./kernels/\"")
else()
  target_compile_definitions(prmers PRIVATE KERNEL_PATH="\"/usr/local/share/prmers/\"")
endif()

if (USE_CURL)
  target_compile_definitions(prmers PRIVATE HAS_CURL=1)
endif()

# === Link libraries ===
target_link_libraries(prmers PRIVATE
  OpenCL::OpenCL
  GMP::gmp
  GMP::gmpxx
)

if (USE_CURL)
  target_link_libraries(prmers PRIVATE CURL::libcurl)
endif()
